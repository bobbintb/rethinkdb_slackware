name: Build rethinkdb
on:
  workflow_dispatch:
jobs:
  slackware-job:
    runs-on: ubuntu-latest
    container: spaceinvaderone/auto_slack_pack
    steps:
    - name: Update and install packages
      run: |
        CONF_FILE="/etc/slackpkg/slackpkg.conf"
        sed -i "s/^DIALOG=.*/DIALOG=off/" "$CONF_FILE"
        sed -i "s/^BATCH=.*/BATCH=on/" "$CONF_FILE"
        sed -i "s/^DEFAULT_ANSWER=.*/DEFAULT_ANSWER=y/" "$CONF_FILE"
        slackpkg update <<< y
        slackpkg install ca-certificates
        update-ca-certificates
    - name: Clone and make
      run: |
        git clone https://github.com/rethinkdb/rethinkdb.git
        cd rethinkdb
        ./configure --allow-fetch PYTHON=/usr/bin/python3
        make -j4
        make install
        pwd
    - name: Run your command
      run: |
        cd ..
        mkdir -p package/usr/local/bin
        cp build/release/rethinkdb package/usr/local/bin
        mkdir -p package/usr/local/share/man/man1
        cp build/release/assets/rethinkdb.1.gz package/usr/local/share/man/man1
        mkdir -p package/usr/local/share/doc/rethinkdb/copyright
        cp ./packaging/assets/docs/LICENSE package/usr/local/share/doc/rethinkdb/copyright
        mkdir -p package/usr/local/etc/init.d
        cp ./packaging/assets/init/rethinkdb package/usr/local/etc/init.d
        mkdir -p package/usr/local/var/lib/rethinkdb/instances.d
        cp /usr/local/etc/rethinkdb/default.conf.sample package/usr/local/etc/rethinkdb/default.conf.sample
        ls -ls ./package
